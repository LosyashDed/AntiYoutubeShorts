### 1. Анатомия расширения (Из чего оно состоит)

Расширение для браузера — это, по сути, маленький веб-сайт, который живет внутри браузера и имеет особые права. Твой проект будет состоять из четырех ключевых компонентов:

1.  **Manifest (Паспорт):** Файл `manifest.json`. Это главный документ. Там написано: «Меня зовут Anti-Shorts, мне нужна иконка вот такая, и дайте мне, пожалуйста, доступ к сайту `youtube.com` и хранилищу настроек». Без него браузер не поймет, что это расширение.
2.  **Popup (Пульт управления):** Тот самый интерфейс с тумблером. Это обычная HTML-страничка + CSS для красоты + маленький JS-скрипт. Когда ты нажимаешь на иконку расширения, открывается это окошко.
3.  **Storage (Память):** Место, где мы храним состояние тумблера (`isEnabled: true` или `false`). Popup записывает туда значение, а «рабочая лошадка» (см. ниже) читает оттуда.
4.  **Content Script (Рабочая лошадка):** Это JS-файл, который браузер насильно внедряет («инжектит») прямо в код страницы YouTube, когда ты её открываешь. Именно этот скрипт имеет доступ к кнопкам, видео и блокам на сайте. Он — твои руки на странице.

---

### 2. Логика работы (Связь тумблера и YouTube)

Вот как данные будут путешествовать:

1.  **Пользователь:** Открывает Popup и щелкает тумблер в положение «ВКЛ» (Блокировать).
2.  **Popup.js:** Ловит клик и сохраняет в `chrome.storage` запись: `{ blockShorts: true }`.
3.  **Content Script (на Ютубе):**
    *   При загрузке страницы он проверяет `chrome.storage`: «Нам надо блокировать?». Если да — запускает чистку.
    *   Он также может подписаться на *изменения* в хранилище. То есть, если ты переключил тумблер, скрипт на открытой вкладке YouTube узнает об этом мгновенно и либо скроет шортсы, либо вернет их обратно (хотя вернуть сложнее, обычно проще заставить пользователя обновить страницу).

---

### 3. Концепции реализации (Как именно убить Shorts?)

Вот тут самое интересное. YouTube — это сложный организм. Есть три основных пути реализации «убийства», от простого к надежному.

#### Вариант А: «CSS-невидимка» (Самый простой)
Мы не удаляем шортсы, мы просто надеваем на них шапку-невидимку.

*   **Как это работает:** Content Script находит на странице блоки с Шортсами (у них есть специфические классы или теги) и добавляет к ним стиль `display: none !important;`.
*   **Плюсы:** Очень легко написать. Меньше глюков, страница не дергается.
*   **Минусы:** Шортсы технически все еще загружаются (тратят трафик), просто ты их не видишь.
*   **Где применимо:** Идеально, чтобы скрыть ленту Shorts на главной странице и в результатах поиска.

#### Вариант Б: «Хирургическое удаление» (DOM Manipulation)
Мы находим элементы в коде страницы и физически вырезаем их из дерева (DOM).

*   **Как это работает:** JS-скрипт ищет элементы и делает им `.remove()`.
*   **Плюсы:** Элементов нет, случайно на них не нажмешь.
*   **Минусы:** Если скрипт сработает раньше, чем YouTube догрузит страницу, он ничего не удалит. Нужно следить за обновлениями страницы (об этом ниже).

#### Вариант В: «Переадресация» (Redirect)
Это нужно, если ты все-таки нажал на ссылку с Шортсом или открыл её напрямую.

*   **Как это работает:** Content Script проверяет URL адрес. Если он видит в адресе `/shorts/videoID`, он автоматически меняет его на `/watch?v=videoID`.
*   **Результат:** Вместо плеера Shorts (который заставляет скроллить дальше), открывается обычный старый плеер YouTube.
*   **Плюсы:** Ты перестаешь залипать, так как интерфейс становится обычным.

---

### 4. Главная проблема: YouTube — это SPA

YouTube — это **Single Page Application**. Это значит, что когда ты кликаешь на логотип или переходишь с видео на видео, страница *не перезагружается* полностью. YouTube просто подгружает новый контент динамически.

**Почему это важно для нас?**
Если мы напишем скрипт «Удали шортсы при загрузке страницы», он сработает один раз при входе. Но как только ты прокрутишь страницу вниз (и подгрузятся новые видео) или перейдешь на главную — шортсы снова появятся, потому что наш скрипт уже отработал и спит.

**Решение: MutationObserver**
Это специальный инструмент в JavaScript. Мы ставим «охранника» (Observer), который следит за телом страницы (`<body>`).
Логика такая:
1.  Охранник видит: «Ога, YouTube добавил новый кусок HTML на страницу».
2.  Мы говорим охраннику: «Проверь этот новый кусок. Если там есть Shorts — удаляй/скрывай».
3.  Это происходит постоянно в реальном времени.

---

### Итоговый план архитектуры для твоего расширения:

Я рекомендую комбинированный подход для лучшего эффекта:

1.  **Popup:** Тумблер пишет `true/false` в хранилище.
2.  **Content Script:**
    *   Использует **CSS-стили** (добавляет класс `block-shorts` к тегу `<body>`), если тумблер включен.
    *   В CSS файле расширения прописано:
        ```css
        body.block-shorts ytd-rich-shelf-renderer[is-shorts] { display: none !important; }
        /* и другие селекторы для кнопок шортс в меню */
        ```
    *   Использует **JS-проверку URL**: Если тумблер включен и мы находимся по адресу `/shorts/...`, перекидывает на обычный плеер.
    *   Использует **MutationObserver**: Чтобы следить за переходами по страницам и снова применять классы/редиректы, если YouTube их сбросил.
